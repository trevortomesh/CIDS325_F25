<!DOCTYPE html>
<html>
    <head>
        <title>Simple Employee Management System (SEMS)</title>
   
    <style>
        body{font-family: Arial, sans-serif; margin: 20px;}
        input, button {margin: 5px 0; padding: 5px}
        ul{padding-left:0}
        li{list-style-type: none; padding: 4px 0}
    </style>
    </head>
    <body>
        <h1>Employees</h1>

        <ul id="employeeList"></ul>

        <h2>Add Employee</h2>
        <form id="addEmployeeForm">
            <input type="text" id="firstName" placeholder="First Name" required/>
            <input type="text" id="lastName" placeholder="Last Name" required/>
            <button type="submit">Add</button>
        </form>
    
    <script>
        const apiBase = 'http://localhost:3000';

        const employeeList = document.getElementById('employeeList');
        const addEmployeeForm = document.getElementById('addEmployeeForm');
        const firstNameInput = document.getElementById('firstName');
        const lastNameInput = document.getElementById('lastName');

        async function loadEmployees(){
            try{
            const res = await fetch(apiBase+'/employees');
            if(!res.ok){
                alert('Failed to fetch employees');
                return;
            }
            const employees = await res.json();
            employeeList.innerHTML = '';
            employees.forEach(e =>{
                const li = document.createElement('li');
                li.textContent = `${e.id}: ${e.firstName} ${e.lastName} `;
                const delBtn = document.createElement('button');
                delBtn.textContent = 'Delete';
                delBtn.style.marginLeft = '10px';
                delBtn.onclick = () => deleteEmployee(e.id);
                li.appendChild(delBtn);
                employeeList.appendChild(li);
            });


        } catch(error){
            alert('Failed to load employees: ' + error.message);
        }
    }

    //Handle form submission to add new employee
    addEmployeeForm.onsubmit = async (e) => {
        e.preventDefault();
        const newEmployee = {
            firstName: firstNameInput.value.trim(),
            lastName: lastNameInput.value.trim()
        };

        if(!newEmployee.firstName || !newEmployee.lastName){
            alert('Please enter both first and last name.');
            return;
        }
        try{
            const res = await fetch(apiBase + '/employees',{
                method: 'POST',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newEmployee)
            });
            if(!res.ok){
                const errMsg = await res.text();
                throw new Error(errMsg);
            }
            firstNameInput.value = '';
            lastNameInput.value = '';
            await loadEmployees();

        }catch(error){
            alert('Failed to add employee: ' + error.message);
        }

    };

    // delete employees by ID
    async function deleteEmployee(id){
        if(!confirm('Delete employee #' + id + '?'))return;
        try{
            const res = await fetch(apiBase + '/employees/' + id, {
                method: 'DELETE'
            });
            if(res.status === 204){
                await loadEmployees();
            }else{
                throw new Error('Delete failed');
            }
            }catch(error){
                alert(error.message);
            }
        }
    


        loadEmployees();
    </script>
    
    
    
    </body>
</html>